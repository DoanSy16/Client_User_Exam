<div class="exam-container">
    <div class="main-content">
        <div class="content-wrapper">
            <!-- Question Section -->
            <div class="question-section">
                <!-- Exam Header -->
                <div class="exam-header">
                    <div class="header-top">
                        <div class="header-left">
                            <div class="stu-logo">
                                <div class="logo-text">STU</div>
                            </div>
                            <div class="exam-title">
                                <h1>B√ÄI THI: {{ examData.discipline_name }}</h1>
                                <div class="exam-info">
                                    Th·ªùi gian l√†m b√†i: <span>{{ examData.time }} ph√∫t</span>
                                </div>
                            </div>

                        </div>
                        <div class="header-right">
                            <div class="timer-container" ng-class="getTimerClass()">
                                <div class="timer">{{ formatTime(timeRemaining) }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="my-0 md-progress header-bottom">
                        <div class="progress-bar {{(timeRemaining <= 120)?'red':'blue'}}" role="progressbar"
                            style="width: {{timeRemaining / (examData.time* 60) * 100}}%"></div>
                    </div>
                </div>

                <!-- Question Content -->
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-number">
                            C√¢u {{ currentQuestion }}/{{ examData.countQuestions }}
                        </div>
                        <div class="question-actions">
                            <button class="submit-btn" ng-click="showSubmitModal()" ng-disabled="!examData.statusExam">
                                N·ªôp b√†i
                            </button>
                        </div>
                    </div>

                    <div class="question-content" ng-if="getCurrentQuestion()">
                        <div class="question-text">{{ getCurrentQuestion().text_question }}</div>

                        <div class="answers-container"
                            ng-class="{'with-images': getCurrentQuestion().source_image && getCurrentQuestion().source_image.length > 0}">

                            <div class="answers-section">
                                <!-- Radio buttons for single choice -->
                                <div ng-if="getCurrentQuestion().type_question_id === 1" class="answer-options">
                                    <div ng-repeat="answer in getCurrentQuestion().Answers_Text track by answer.answer_option_id"
                                        class="answer-option" ng-mouseenter="setHover(answer.image_answer_id)"
                                        ng-mouseleave="clearHover()">

                                        <input type="radio" id="answer-{{ answer.answer_option_id }}"
                                            name="question-{{ getCurrentQuestion().question_id }}"
                                            ng-value="answer.answer_option_id" ng-model="answers[currentQuestion]"
                                            ng-change="updateAnsweredCount()" ng-disabled="!examData.statusExam">

                                        <label for="answer-{{ answer.answer_option_id }}">
                                            <span class="option-letter">{{ getOptionLetter($index) }}</span>
                                            <span class="option-text">
                                                {{ answer.text_answer }}
                                            </span>
                                        </label>

                                    </div>
                                </div>

                                <!-- Checkboxes for multiple choice -->
                                <div ng-if="getCurrentQuestion().type_question_id === 2" class="answer-options">
                                    <div ng-repeat="answer in getCurrentQuestion().Answers_Text track by answer.answer_option_id"
                                        class="answer-option">
                                        <input type="checkbox" id="answer-{{ answer.answer_option_id }}"
                                            ng-value="answer.answer_option_id"
                                            ng-checked="isCheckboxSelected(answer.answer_option_id)"
                                            ng-click="toggleCheckbox(answer.answer_option_id)"
                                            ng-disabled="!examData.statusExam">
                                        <label for="answer-{{ answer.answer_option_id }}">
                                            <span class="option-letter">{{ getOptionLetter($index) }}</span>
                                            <span class="option-text">{{ answer.text_answer }}</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Text input for essay questions -->
                                <div ng-if="getCurrentQuestion().type_question_id === 3">
                                    <textarea class="text-input" ng-model="answers[currentQuestion]"
                                        ng-change="updateAnsweredCount()" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n..."
                                        ng-disabled="!examData.statusExam"></textarea>
                                </div>
                            </div>

                            <!-- Images section -->
                            <!-- <div ng-if="getCurrentQuestion().source_image && getCurrentQuestion().source_image.length > 0"
                                ng-repeat="image in getCurrentQuestion().source_image" class="images-section">
                                <img ng-src="{{ image.source_image }}" alt="H√¨nh ·∫£nh c√¢u h·ªèi" class="question-image">
                                <p>{{image.content}}</p>
                            </div> -->

                            <div class="images-section"
                                ng-if="getCurrentQuestion().source_image && getCurrentQuestion().source_image.length > 0">
                                <div ng-repeat="image in getCurrentQuestion().source_image track by image.image_id">
                                    <img ng-src="{{ image.source_image }}" class="question-image"
                                        id="img-question-{{image.image_id}}"
                                        ng-class="{'highlight': +hoverImageId === image.image_id}">

                                    <p>{{image.content}}</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Student Info -->
                <div class="student-info">
                    <div class="info-card">
                        <div class="student-details">
                            <div class="info-group">
                                <span class="info-label">H·ªç t√™n:</span>
                                <span class="info-value">{{ examData.nameSelected }}</span>
                            </div>
                            <div class="info-group">
                                <span class="info-label">MSSV:</span>
                                <span class="info-value">{{ examData.isSelected }}</span>
                            </div>
                            <div class="info-group">
                                <span class="info-label">L·ªõp:</span>
                                <span class="info-value">{{ examData.classNameSelected }}</span>
                            </div>
                            <div class="info-group progress-info">
                                <span class="info-label">Ti·∫øn ƒë·ªô</span>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" ng-style="{'width': getProgressPercentage() + '%'}">
                                        </div>
                                    </div>
                                    <span class="info-value">{{ getAnsweredCount() }}/{{ examData.countQuestions
                                        }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Question Navigation -->
                <div class="question-sidebar">
                    <h3>Danh s√°ch c√¢u h·ªèi</h3>
                    <div class="question-grid">
                        <button ng-repeat="questionNum in questionNumbers track by $index" class="question-btn"
                            ng-class="getQuestionButtonClass(questionNum)" ng-click="goToQuestion(questionNum)"
                            ng-disabled="!examData.statusExam">
                            {{ questionNum }}
                        </button>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-color current"></span>
                            <span>ƒêang l√†m</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color answered"></span>
                            <span>ƒê√£ l√†m</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color unanswered"></span>
                            <span>Ch∆∞a l√†m</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab Change Warning Modal -->
<div class="modal" ng-show="showWarningModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>‚ö†Ô∏è C·∫£nh b√°o</h3>
        </div>
        <div class="modal-body">
            <p>B·∫°n ƒë√£ chuy·ªÉn sang tab kh√°c. ƒêi·ªÅu n√†y c√≥ th·ªÉ b·ªã coi l√† gian l·∫≠n trong b√†i thi.</p>
            <!-- <p>S·ªë l·∫ßn chuy·ªÉn tab: <span>{{ tabSwitchCount }}</span></p> -->
        </div>
        <div class="modal-footer">
            <button ng-disabled="isShowWarningModal" class="modal-btn error" ng-click="requestReconnect()">
                {{!isShowWarningModal?'Y√™u c·∫ßu k·∫øt n·ªëi':'ƒê·ª£i ph·∫£n h·ªìi'}}
            </button>
        </div>
    </div>
</div>

<!-- Submit Confirmation Modal -->
<div class="modal" ng-show="showSubmitConfirmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üìù X√°c nh·∫≠n n·ªôp b√†i</h3>
        </div>
        <div class="modal-body">
            <p>B·∫°n ƒë√£ tr·∫£ l·ªùi {{ getAnsweredCount() }}/{{ examData.countQuestions }} c√¢u h·ªèi.</p>
            <p><strong>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?</strong></p>
            <p class="warning-text">Sau khi n·ªôp b√†i, b·∫°n s·∫Ω kh√¥ng th·ªÉ ch·ªânh s·ª≠a c√¢u tr·∫£ l·ªùi.</p>
        </div>
        <div class="modal-footer">
            <button class="modal-btn secondary" ng-click="closeSubmitModal()">H·ªßy</button>
            <button class="modal-btn primary" ng-click="confirmSubmit()">N·ªôp b√†i</button>
        </div>
    </div>
</div>
